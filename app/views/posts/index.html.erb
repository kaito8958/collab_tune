<!--  ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
<% unless user_signed_in? %>
  <section class="bg-gradient-to-r from-purple-50 to-indigo-50 py-12 text-center">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-3">ã‚³ãƒ©ãƒœã§åºƒãŒã‚‹éŸ³ã®ä¸–ç•Œã€‚</h1>
    <p class="text-gray-600 mb-6">CollabTuneã¯ã€DTMã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ãŒç¹‹ãŒã‚Šã€å…±ã«æ›²ã‚’ä½œã‚‹ãŸã‚ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã™ã€‚</p>
    <%= link_to "æ–°è¦ç™»éŒ²ã—ã¦ã¯ã˜ã‚ã‚‹", new_user_registration_path,
        class: "bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-full font-semibold shadow-md hover:shadow-lg transition" %>
  </section>
<% end %>

<!--  æŠ•ç¨¿ä¸€è¦§ï¼ˆå…¨å“¡è¡¨ç¤ºï¼‰ -->
<section class="max-w-6xl mx-auto px-6 py-12">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ§ æœ€æ–°ã®ã‚³ãƒ©ãƒœå‹Ÿé›†</h2>

  <div class="flex flex-col items-center space-y-6">
  <%= render partial: "post_card", collection: @posts, as: :post %>  </div>
</section>

<!--  CTAï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿ï¼‰ -->
<% unless user_signed_in? %>
  <section class="bg-purple-50 py-10 text-center">
    <h2 class="text-xl font-bold text-gray-700 mb-3">ã‚ãªãŸã®éŸ³ã‚’èª°ã‹ã¨ç¹‹ã’ã‚ˆã†</h2>
    <%= link_to "ä»Šã™ãç™»éŒ²ã™ã‚‹", new_user_registration_path,
        class: "bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white px-6 py-2 rounded-full font-semibold shadow-md hover:shadow-lg transition" %>
  </section>
<% end %>

<script>
  function togglePlay(postId) {
    const audio = document.getElementById(`audio-${postId}`);
    const btn = document.querySelector(`#btn-${postId}`);
    const progress = document.getElementById(`progress-${postId}`);
    const timeDisplay = document.getElementById(`time-${postId}`);

    if (!audio || !btn) return;

    // ä»–ã®audioã‚’ã™ã¹ã¦åœæ­¢
    document.querySelectorAll("audio").forEach(a => {
      if (a !== audio) {
        a.pause();
        a.currentTime = 0;
        const otherId = a.id.split("-")[1];
        const otherBtn = document.querySelector(`#btn-${otherId}`);
        const otherProgress = document.getElementById(`progress-${otherId}`);
        if (otherBtn) {
          otherBtn.innerHTML =
            '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-white" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>';
        }
        if (otherProgress) {
          otherProgress.style.width = "0%";
        }
      }
    });

    // å†ç”Ÿï¼ä¸€æ™‚åœæ­¢ã®ãƒˆã‚°ãƒ«
    if (audio.paused) {
      audio.play();
      btn.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-white" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>';
    } else {
      audio.pause();
      btn.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-white" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>';
    }

    // å†ç”Ÿä¸­ãƒãƒ¼ã®é€²è¡Œ
    audio.ontimeupdate = () => {
      if (progress && audio.duration > 0) {
        const percent = (audio.currentTime / audio.duration) * 100;
        progress.style.width = percent + "%";

        const current = formatTime(audio.currentTime);
        const total = formatTime(audio.duration);
        timeDisplay.textContent = `${current} / ${total}`;
      }
    };

    // å†ç”Ÿçµ‚äº†æ™‚ãƒªã‚»ãƒƒãƒˆ
    audio.onended = () => {
      btn.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-white" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>';
      if (progress) progress.style.width = "0%";
    };
  }
  function formatTime(seconds) {
  if (isNaN(seconds)) return "0:00";
  const minutes = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${minutes}:${secs < 10 ? "0" + secs : secs}`;
}
</script>



