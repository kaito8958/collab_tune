<div class="min-h-screen bg-gradient-to-b from-[#C7D3E0] to-[#E5EBF2] py-10 px-4">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-3xl font-extrabold text-center text-gray-800 mb-10">コラボ申請一覧</h2>

    <div class="grid md:grid-cols-2 gap-8">
      <!-- 📥 受信した申請 -->
      <div class="bg-white/95 backdrop-blur-md shadow-md rounded-2xl border border-gray-200 p-6">
        <h3 class="text-xl font-bold text-indigo-700 mb-5 text-center">📥 受信した申請</h3>

        <% if @received_collaborations.any? %>
          <% @received_collaborations.each do |collab| %>
            <% partner = collab.requester %>
            <div class="relative bg-white border border-gray-200 rounded-2xl shadow-sm p-5 mb-5 hover:shadow-md transition">

      <!-- 👤 相手＋投稿（横並び） -->
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3 overflow-hidden">
          <% if partner.icon.attached? %>
            <%= image_tag partner.icon.variant(resize_to_fill: [42, 42]).processed,
                class: "w-[42px] h-[42px] rounded-full border border-gray-200 shadow-sm object-cover" %>
          <% else %>
            <%= image_tag "default_icon.png", size: "42x42",
                class: "rounded-full border border-gray-200 shadow-sm object-cover" %>
          <% end %>

          <div class="flex flex-col">
            <div class="flex flex-wrap items-baseline gap-x-2">
              <p class="text-[15px] font-bold text-gray-800 truncate ml-3">
                <%= link_to partner.nickname, user_path(partner), class: "hover:text-indigo-600 hover:underline" %>
              </p>
              <p class="text-[18px] text-purple-700 font-semibold truncate ml-5">
                <%= link_to collab.post.title, post_path(collab.post), class: "hover:underline" %>
              </p>
            </div>
            <p class="text-[10px] text-gray-400 -mt-0.5">とのチャット</p>
          </div>
        </div>

        <!-- ステータスバッジ -->
        <% status_class = case collab.status
          when "accepted" then "bg-green-100 text-green-700"
          when "rejected" then "bg-red-100 text-red-700"
          else "bg-yellow-100 text-yellow-700"
        end %>
        <span class="text-xs font-semibold px-3 py-1 rounded-full <%= status_class %> whitespace-nowrap">
          <%= collab.status == "pending" ? "承認待ち" : collab.status == "accepted" ? "承認済み" : "拒否済み" %>
        </span>
      </div>
              <!-- 💬 メッセージ -->
              <% if collab.message.present? %>
                <p class="text-sm text-gray-700 leading-relaxed bg-indigo-50/70 px-3 py-2 rounded-lg mb-6">
                  <%= collab.message %>
                </p>
              <% end %>

              <!-- ✅ アクションボタン -->
              <% if collab.status == "pending" %>
                <div class="flex justify-center space-x-5 mt-2">
                  <%= button_to "承認",
                        collaboration_path(collab, status: "accepted"),
                        method: :patch,
                        class: "px-6 py-2 bg-green-500 hover:bg-green-600 text-white text-sm font-bold rounded-lg shadow-md transition" %>

                  <%= button_to "拒否",
                        collaboration_path(collab, status: "rejected"),
                        method: :patch,
                        class: "px-6 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-bold rounded-lg shadow-md transition" %>
                </div>
              <% elsif collab.status == "accepted" && collab.chat_room.present? %>
                <%= link_to "チャットへ", chat_room_path(collab.chat_room),
                    class: "absolute bottom-3 right-5 text-xs text-gray-500 hover:text-gray-700 underline transition" %>
              <% elsif collab.status == "rejected" %>
                <p class="text-xs text-gray-500 text-center mt-2">この申請は拒否済みです。</p>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p class="text-gray-500 text-sm text-center">受信した申請はありません。</p>
        <% end %>
      </div>

      <!-- 📤 送信した申請 -->
      <div class="bg-white/95 backdrop-blur-md shadow-md rounded-2xl border border-gray-200 p-6">
        <h3 class="text-xl font-bold text-purple-700 mb-5 text-center">📤 送信した申請</h3>

        <% if @sent_collaborations.any? %>
          <% @sent_collaborations.each do |collab| %>
            <% partner = collab.receiver %>
            <div class="relative bg-white border border-gray-200 rounded-2xl shadow-sm p-5 mb-5 hover:shadow-md transition">

              <!-- 👤 相手＋投稿（横並び） -->
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-3 overflow-hidden">
                  <% if partner.icon.attached? %>
                    <%= image_tag partner.icon.variant(resize_to_fill: [42, 42]).processed,
                        class: "w-[42px] h-[42px] rounded-full border border-gray-200 shadow-sm object-cover" %>
                  <% else %>
                    <%= image_tag "default_icon.png", size: "42x42",
                        class: "rounded-full border border-gray-200 shadow-sm object-cover" %>
                  <% end %>

                  <div class="flex flex-wrap items-baseline gap-x-2">
                    <p class="text-[15px] font-bold text-gray-800 truncate">
                      <%= link_to partner.nickname, user_path(partner), class: "hover:text-purple-600 hover:underline" %>
                    </p>
                    <p class="text-[14px] text-purple-700 font-semibold truncate">
                      🎵 <%= link_to collab.post.title, post_path(collab.post), class: "hover:underline" %>
                    </p>
                  </div>
                </div>

                <% status_class = case collab.status
                  when "accepted" then "bg-green-100 text-green-700"
                  when "rejected" then "bg-red-100 text-red-700"
                  else "bg-yellow-100 text-yellow-700"
                end %>
                <span class="text-xs font-semibold px-3 py-1 rounded-full <%= status_class %> whitespace-nowrap">
                  <%= collab.status == "pending" ? "承認待ち" : collab.status == "accepted" ? "承認済み" : "拒否済み" %>
                </span>
              </div>

              <% if collab.message.present? %>
                <p class="text-sm text-gray-700 leading-relaxed bg-purple-50/70 px-3 py-2 rounded-lg mb-6">
                  <%= collab.message %>
                </p>
              <% end %>

              <% if collab.status == "accepted" && collab.chat_room.present? %>
                <%= link_to "チャットへ", chat_room_path(collab.chat_room),
                    class: "absolute bottom-3 right-5 text-xs text-gray-500 hover:text-gray-700 underline transition" %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p class="text-gray-500 text-sm text-center">送信した申請はありません。</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
